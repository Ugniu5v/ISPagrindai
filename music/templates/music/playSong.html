{% extends "_base.html" %}
{% block title %}Klausyti dainą › Muzikos sistema{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-start mb-4">
  <h2 class="fw-semibold mb-0">Klausyti dainą</h2>
  <a href="{% url 'music:index' %}" class="btn btn-primary">Atgal</a>
</div>

{% if errors %}
<div class="alert alert-danger" role="alert">
  <ul class="mb-0">
    {% for error in errors %}
    <li>{{ error }}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

{% if song %}
<div class="card bg-body-tertiary shadow-sm">
  <div class="card-body">
    <h4 class="card-title">{{ song.pavadinimas }}</h4>
    <p class="mb-2 text-secondary">Žanras: {{ song.get_zanras_display }} • Trukmė: {{ song.trukme_sekundes }}s</p>
    {% if song.isleidimo_data %}<p class="mb-2 text-secondary">Išleidimo data: {{ song.isleidimo_data }}</p>{% endif %}

    <div class="mb-3">
      <strong>Vidutinis įvertinimas:</strong>
      {% if rating_avg %}
        {{ rating_avg|floatformat:1 }} ({{ rating_count }} įvert.)
      {% else %}
        Nėra įvertinimų
      {% endif %}
    </div>

    {% if song.virselis_url %}
    <div class="mb-3">
      <img src="{{ song.virselis_url }}" alt="Cover for {{ song.pavadinimas }}" class="img-fluid rounded border border-secondary">
    </div>
    {% endif %}

    {% if song.failas_url %}
    <div class="mb-3">
      <audio id="audio-player" controls autoplay class="w-100">
        <source src="{{ audio_url }}" {% if audio_mime %}type="{{ audio_mime }}"{% endif %} />
        Your browser does not support the audio element.
      </audio>
    </div>
    {% else %}
    <div class="alert alert-warning text-dark" role="alert">
      Nėra failo URL šiai dainai.
    </div>
    {% endif %}

    <div class="mt-3">
      <h6>Žodžiai</h6>
      {% if song.zodziai %}
      <pre class="border border-secondary rounded p-3" style="white-space: pre-wrap;">{{ song.zodziai }}</pre>
      {% else %}
      <p class="text-secondary small mb-0">Žodžių failas nepateiktas.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
