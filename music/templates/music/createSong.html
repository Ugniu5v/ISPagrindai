{% extends "_base.html" %}
{% block title %}Sukurti dainą › Muzikos sistema{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-start mb-4">
  <h2 class="fw-semibold mb-0">Sukurti dainą</h2>
  <a href="{% url 'music:index' %}" class="btn btn-primary">Atgal</a>
</div>

{% if success_message %}
<div class="alert alert-success" role="alert">
  {{ success_message }}
</div>
{% endif %}

{% if errors or field_errors %}
<div class="alert alert-danger" role="alert">
  <strong>Nepavyko sukurti.</strong> Patikslinkite pažymėtus laukus.
  {% if errors %}
  <ul class="mb-0">
    {% for error in errors %}
    <li>{{ error }}</li>
    {% endfor %}
  </ul>
  {% endif %}
</div>
{% endif %}

<div class="card bg-body-tertiary shadow-sm">
  <div class="card-body">
    <form method="post" action="{% url 'music:createSong' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="row g-3">
        <div class="col-md-6">
          <label for="name" class="form-label">Pavadinimas *</label>
          <input type="text" class="form-control {% if field_errors.name %}is-invalid{% endif %}" id="name" name="name" value="{{ form_data.name|default:'' }}">
          {% if field_errors.name %}<div class="invalid-feedback d-block">{{ field_errors.name }}</div>{% endif %}
        </div>
        <div class="col-md-6">
          <label for="time" class="form-label">Trukmė (min) *</label>
          <input type="number" class="form-control {% if field_errors.time %}is-invalid{% endif %}" id="time" name="time" min="0" step="0.01" value="{{ form_data.time|default:'' }}">
          {% if field_errors.time %}<div class="invalid-feedback d-block">{{ field_errors.time }}</div>{% endif %}
        </div>
        <div class="col-md-6">
          <label for="release_date" class="form-label">Išleidimo data *</label>
          <input type="date" class="form-control {% if field_errors.release_date %}is-invalid{% endif %}" id="release_date" name="release_date" value="{{ form_data.release_date|default:'' }}">
          {% if field_errors.release_date %}<div class="invalid-feedback d-block">{{ field_errors.release_date }}</div>{% endif %}
        </div>
        <div class="col-md-6">
          <label for="genre" class="form-label">Žanras *</label>
          <select class="form-select {% if field_errors.genre %}is-invalid{% endif %}" id="genre" name="genre">
            <option value="">Pasirinkite žanrą</option>
            {% for value, label in zanrai %}
            <option value="{{ value }}" {% if form_data.genre == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          {% if field_errors.genre %}<div class="invalid-feedback d-block">{{ field_errors.genre }}</div>{% endif %}
        </div>
        <div class="col-md-6">
          <label for="file_url" class="form-label">Failo URL</label>
          <input type="url" class="form-control" id="file_url" name="file_url" value="{{ form_data.file_url|default:'' }}" placeholder="https://...">
        </div>
        <div class="col-md-6">
          <label for="cover_url" class="form-label">Viršelio URL</label>
          <input type="url" class="form-control" id="cover_url" name="cover_url" value="{{ form_data.cover_url|default:'' }}" placeholder="https://...">
        </div>
        <div class="col-12">
          <label for="description" class="form-label">Aprašymas</label>
          <textarea class="form-control" id="description" name="description" rows="3">{{ form_data.description|default:'' }}</textarea>
        </div>
        <div class="col-12">
          <label for="words" class="form-label">Dainos žodžiai (TXT)</label>
          <input type="file" class="form-control" id="words" name="words" accept=".txt">
        </div>
        <div class="col-12 form-check">
          <input type="checkbox" class="form-check-input" id="is_public" name="is_public" {% if form_data.is_public|default:'on' %}checked{% endif %}>
          <label class="form-check-label" for="is_public">Vieša</label>
        </div>
      </div>
      <div class="mt-4 d-flex gap-2">
        <button type="submit" class="btn btn-primary">Sukurti</button>
        <a href="{% url 'music:index' %}" class="btn btn-secondary">Atšaukti</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
