{% extends "_base.html" %}
{% block title %}Koncertai • Muzikos sistema{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-start">
    <h2 class="mb-4 fw-semibold">Koncertai</h2>
    {% if "user" in request.session %}
      <a href="{% url 'concerts:createConcert' %}" class="btn btn-outline-light me-2">
        Skelbti naują Koncertą
      </a>
    {% endif %}
  </div>

  <div class="card shadow-sm mb-4 bg-body-tertiary">
    <div class="card-body">
      <form method="get" action="{% url 'concerts:index' %}">
        <h5 class="card-title mb-3">Ieškoti Koncertų</h5>
        <div class="input-group mb-3">
          <input
            type="text"
            class="form-control"
            placeholder="Ieškoti koncertų..."
            name="q"
            value="{{ search_query }}"
          />
          <button class="btn btn-primary" type="submit">Ieškoti</button>
        </div>

        <h5 class="card-title mb-3">Filtrai</h5>
        <div class="row g-3">
          <div class="col-md-3">
            <label for="filterGenre" class="form-label">Žanras</label>
            <select class="form-select" id="filterGenre" name="genre">
              <option value="">Visi žanrai</option>
              {% if zanrai %}
                {% for value, label in zanrai %}
                  <option value="{{ value }}" {% if selected_genre == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              {% endif %}
            </select>
          </div>
          <div class="col-md-3">
            <label for="filterStatus" class="form-label">Būsena</label>
            <select class="form-select" id="filterStatus" name="status">
              <option value="">Visos būsenos</option>
              <option value="public" {% if selected_status == 'public' %}selected{% endif %}>Viešas</option>
              <option value="private" {% if selected_status == 'private' %}selected{% endif %}>Privatus</option>
              <option value="cancelled" {% if selected_status == 'cancelled' %}selected{% endif %}>Atšauktas</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="filterDate" class="form-label">Data</label>
            <select class="form-select" id="filterDate" name="date">
              <option value="">Visos datos</option>
              <option value="today" {% if selected_date == 'today' %}selected{% endif %}>Šiandien</option>
              <option value="week" {% if selected_date == 'week' %}selected{% endif %}>Šią savaitę</option>
              <option value="month" {% if selected_date == 'month' %}selected{% endif %}>Šį mėnesį</option>
              <option value="upcoming" {% if selected_date == 'upcoming' %}selected{% endif %}>Būsimi</option>
              <option value="past" {% if selected_date == 'past' %}selected{% endif %}>Praėję</option>
            </select>
          </div>
        </div>
        <div class="mt-3">
          <button type="submit" class="btn btn-primary me-2">Taikyti filtrus</button>
          <a href="{% url 'concerts:index' %}" class="btn btn-secondary">Išvalyti filtrus</a>
        </div>
      </form>
    </div>
  </div>

  {% if koncertai %}
    <div class="row g-4">
      {% for koncertas in koncertai %}
        <div class="col-sm-6 col-md-4 col-lg-3">
          <a class="card concert-card" href="{% url 'concerts:concertDetail' pk=koncertas.pk %}">
            <img
              src="https://picsum.photos/320/180?random={{ koncertas.pk }}"
              class="card-img-top"
              alt="Concert cover"
            />
            <div class="card-body">
              <small class="text-muted">{% if koncertas.pradzios_data %}{{ koncertas.pradzios_data|date:"Y M d" }}{% endif %} - {% if koncertas.pabaigos_data %}{{ koncertas.pabaigos_data|date:"d" }}{% endif %} · {{ koncertas.get_zanras_display }}</small>
              <h5 class="card-title mt-2">{{ koncertas.pavadinimas }}</h5>
              <small class="text-muted">
                Bilietų: {{ koncertas.zmoniu_talpa }}
              </small>
              {% if not koncertas.yra_viesas %}
                <div class="mt-2"><span class="badge bg-secondary">Privatus</span></div>
              {% endif %}
              {% if koncertas.yra_atsauktas %}
                <div class="mt-2"><span class="badge bg-danger">Atšauktas</span></div>
              {% endif %}
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      Koncertų nerasta.
      {% if "user" in request.session %}
        <a href="{% url 'concerts:createConcert' %}">Sukurkite dabar!</a>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}
