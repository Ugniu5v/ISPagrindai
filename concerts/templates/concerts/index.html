<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Concerts</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-black text-white p-4">
    <div class="container mt-4">
      <h1 class="mb-4">Concerts</h1>

      <nav class="mb-4">
        <a href="{% url 'concerts:createConcert' %}" class="btn btn-outline-light me-2"
          >Create Concert</a
        >
        <a href="{% url 'homepage' %}" class="btn btn-outline-light">Back to Home</a>
      </nav>

      <div class="mb-4">
        <form method="get" action="{% url 'concerts:index' %}">
          <div class="card bg-dark text-white mb-3">
            <div class="card-body">
              <h5 class="card-title mb-3">Search Concerts</h5>
              <div class="input-group">
                <input
                  type="text"
                  class="form-control form-control-lg bg-black text-white"
                  placeholder="Search by concert name..."
                  name="q"
                  value="{{ search_query }}"
                />
                <button class="btn btn-primary" type="submit">Search</button>
              </div>
            </div>
          </div>

          <div class="card bg-dark text-white">
            <div class="card-body">
              <h5 class="card-title mb-3">Filters</h5>
              <div class="row g-3">
                <div class="col-md-3">
                  <label for="filterGenre" class="form-label">Genre</label>
                  <select class="form-select bg-black text-white" id="filterGenre" name="genre">
                    <option value="">All Genres</option>
                    {% if zanrai %}
                      {% for value, label in zanrai %}
                        <option value="{{ value }}" {% if selected_genre == value %}selected{% endif %}>{{ label }}</option>
                      {% endfor %}
                    {% endif %}
                  </select>
                </div>
                <div class="col-md-3">
                  <label for="filterStatus" class="form-label">Status</label>
                  <select class="form-select bg-black text-white" id="filterStatus" name="status">
                    <option value="">All Status</option>
                    <option value="public" {% if selected_status == 'public' %}selected{% endif %}>Public</option>
                    <option value="private" {% if selected_status == 'private' %}selected{% endif %}>Private</option>
                    <option value="cancelled" {% if selected_status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label for="filterDate" class="form-label">Date Range</label>
                  <select class="form-select bg-black text-white" id="filterDate" name="date">
                    <option value="">All Dates</option>
                    <option value="today" {% if selected_date == 'today' %}selected{% endif %}>Today</option>
                    <option value="week" {% if selected_date == 'week' %}selected{% endif %}>This Week</option>
                    <option value="month" {% if selected_date == 'month' %}selected{% endif %}>This Month</option>
                    <option value="upcoming" {% if selected_date == 'upcoming' %}selected{% endif %}>Upcoming</option>
                    <option value="past" {% if selected_date == 'past' %}selected{% endif %}>Past</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label for="filterScore" class="form-label">Min Score</label>
                  <select class="form-select bg-black text-white" id="filterScore" name="score">
                    <option value="">All Scores</option>
                    <option value="9" {% if selected_score == '9' %}selected{% endif %}>9+</option>
                    <option value="8" {% if selected_score == '8' %}selected{% endif %}>8+</option>
                    <option value="7" {% if selected_score == '7' %}selected{% endif %}>7+</option>
                    <option value="6" {% if selected_score == '6' %}selected{% endif %}>6+</option>
                    <option value="5" {% if selected_score == '5' %}selected{% endif %}>5+</option>
                  </select>
                </div>
              </div>
              <div class="mt-3">
                <button type="submit" class="btn btn-primary me-2">Apply Filters</button>
                <a href="{% url 'concerts:index' %}" class="btn btn-secondary">Clear Filters</a>
              </div>
            </div>
          </div>
        </form>
      </div>

      {% if koncertai %}
        {% for koncertas in koncertai %}
          <div class="card bg-dark text-white mb-3">
            <div class="card-body">
              <h5 class="card-title">{{ koncertas.pavadinimas }}</h5>
              {% if koncertas.pradzios_data %}
                <p class="card-text"><strong>Start:</strong> {{ koncertas.pradzios_data|date:"M d, Y" }}</p>
              {% endif %}
              {% if koncertas.pabaigos_data %}
                <p class="card-text"><strong>End:</strong> {{ koncertas.pabaigos_data|date:"M d, Y" }}</p>
              {% endif %}
              <p class="card-text"><strong>Genre:</strong> {{ koncertas.get_zanras_display }}</p>
              <p class="card-text"><strong>Tickets:</strong> {{ koncertas.zmoniu_talpa }}</p>
              {% if koncertas.rekomendacijos_ivertis %}
                <p class="card-text"><strong>Score:</strong> {{ koncertas.rekomendacijos_ivertis }}/10</p>
              {% endif %}
              {% if not koncertas.yra_viesas %}
                <p class="card-text"><strong>Status:</strong> Private</p>
              {% endif %}
              {% if koncertas.yra_atsauktas %}
                <p class="card-text text-danger"><strong>Status:</strong> Cancelled</p>
              {% endif %}
              <a href="{% url 'concerts:concertDetail' pk=koncertas.pk %}" class="btn btn-primary me-2">View Details</a>
              <a href="{% url 'concerts:editConcert' pk=koncertas.pk %}" class="btn btn-secondary">Edit</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="alert alert-info">
          No concerts found. <a href="{% url 'concerts:createConcert' %}">Create one now!</a>
        </div>
      {% endif %}
    </div>
  </body>
</html>
