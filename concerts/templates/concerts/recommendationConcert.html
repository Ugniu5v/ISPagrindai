{% extends "_base.html" %}
{% block title %}Koncerto rekomendacijos • Muzikos sistema{% endblock %}

{% block content %}
  <h2 class="mb-4 fw-semibold">Koncerto rekomendacijos</h2>

  <div class="card shadow-sm mb-4 bg-body-tertiary">
    <div class="card-body">
      <h5 class="card-title mb-3">Gauti koncerto rekomendacijas</h5>
      <form method="post" action="#">
        {% csrf_token %}
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="preferred_genre" class="form-label">Pageidaujamas žanras</label>
            <select
              class="form-select"
              id="preferred_genre"
              name="preferred_genre"
            >
              <option value="">Bet koks žanras</option>
              {% if zanrai %}
                {% for value, label in zanrai %}
                  <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
              {% endif %}
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="date_from" class="form-label">Nuo datos</label>
            <input
              type="datetime-local"
              class="form-control"
              id="date_from"
              name="date_from"
            />
          </div>

          <div class="col-md-6 mb-3">
            <label for="date_to" class="form-label">Iki datos</label>
            <input
              type="datetime-local"
              class="form-control"
              id="date_to"
              name="date_to"
            />
          </div>
        </div>

        <div class="mb-3">
          <label for="max_tickets" class="form-label">Maksimalus bilietų kiekis</label>
          <input
            type="number"
            class="form-control"
            id="max_tickets"
            name="max_tickets"
            min="1"
            placeholder="Palikite tuščią, jei bet koks dydis"
          />
        </div>

        <div class="mb-3 form-check">
          <input
            type="checkbox"
            class="form-check-input"
            id="public_only"
            name="public_only"
            checked
          />
          <label class="form-check-label" for="public_only">Tik vieši koncertai</label>
        </div>

        <div class="mb-3 form-check">
          <input
            type="checkbox"
            class="form-check-input"
            id="exclude_cancelled"
            name="exclude_cancelled"
            checked
          />
          <label class="form-check-label" for="exclude_cancelled">
            Neįtraukti atšauktų koncertų
          </label>
        </div>

        <button type="submit" class="btn btn-primary">Gauti rekomendacijas</button>
      </form>
    </div>
  </div>

  {% if koncertai %}
    <h3 class="mb-4 fw-semibold">Rekomenduojami koncertai</h3>
    <div class="row g-4">
      {% for koncertas in koncertai %}
        <div class="col-sm-6 col-md-4 col-lg-3">
          <a class="card concert-card" href="{% url 'concerts:concertDetail' pk=koncertas.pk %}">
            <img
              src="https://picsum.photos/320/180?random={{ koncertas.pk }}"
              class="card-img-top"
              alt="Concert cover"
            />
            <div class="card-body">
              <small class="text-muted">{% if koncertas.pradzios_data %}{{ koncertas.pradzios_data|date:"Y M d" }}{% endif %} - {% if koncertas.pabaigos_data %}{{ koncertas.pabaigos_data|date:"d" }}{% endif %} · {{ koncertas.get_zanras_display }}</small>
              <h5 class="card-title mt-2">{{ koncertas.pavadinimas }}</h5>
              <small class="text-muted">
                Bilietų: {{ koncertas.zmoniu_talpa }} · Įvertis: 
                <span class="{% if koncertas.rekomendacijos_ivertis >= 9 %}text-success{% elif koncertas.rekomendacijos_ivertis >= 7 %}text-warning{% else %}text-info{% endif %}">
                  {{ koncertas.rekomendacijos_ivertis|floatformat:1 }}/10
                </span>
              </small>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      Koncertų, atitinkančių jūsų kriterijus, nerasta. Pabandykite pakoreguoti filtrus.
    </div>
  {% endif %}
{% endblock %}
