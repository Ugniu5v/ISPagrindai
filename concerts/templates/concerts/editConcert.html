{% extends "_base.html" %}
{% block title %}Redaguoti koncertą • Muzikos sistema{% endblock %}

{% block content %}
  <h2 class="mb-4 fw-semibold">Redaguoti koncertą</h2>

  <div class="alert alert-info mb-4">
    <strong>Redaguojama:</strong> {{ koncertas.pavadinimas }}<br />
    <strong>Sukurta:</strong> {% if koncertas.sukurimo_data %}{{ koncertas.sukurimo_data|date:"Y M d" }}{% else %}Nenurodyta{% endif %}<br />
    <strong>Paskutinį kartą atnaujinta:</strong> {% if koncertas.atnaujinimo_data %}{{ koncertas.atnaujinimo_data|date:"Y M d" }}{% else %}Nenurodyta{% endif %}
  </div>

  <div class="card shadow-sm bg-body-tertiary">
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          <label for="pavadinimas" class="form-label">Koncerto pavadinimas *</label>
          <input
            type="text"
            class="form-control"
            id="pavadinimas"
            name="pavadinimas"
            value="{{ koncertas.pavadinimas }}"
            required
          />
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="pradzios_data" class="form-label">Pradžios data *</label>
            <input
              type="date"
              class="form-control"
              id="pradzios_data"
              name="pradzios_data"
              value="{% if koncertas.pradzios_data %}{{ koncertas.pradzios_data|date:'Y-m-d' }}{% endif %}"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="pabaigos_data" class="form-label">Pabaigos data *</label>
            <input
              type="date"
              class="form-control"
              id="pabaigos_data"
              name="pabaigos_data"
              value="{% if koncertas.pabaigos_data %}{{ koncertas.pabaigos_data|date:'Y-m-d' }}{% endif %}"
              required
            />
          </div>
        </div>

        <div class="mb-3">
          <label for="bilietu_url" class="form-label">Bilietų nuoroda</label>
          <input
            type="url"
            class="form-control"
            id="bilietu_url"
            name="bilietu_url"
            value="{{ koncertas.bilietu_url }}"
          />
        </div>

        <div class="mb-3">
          <label for="aprasymas" class="form-label">Aprašymas</label>
          <textarea
            class="form-control"
            id="aprasymas"
            name="aprasymas"
            rows="4"
          >{{ koncertas.aprasymas }}</textarea>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="zmoniu_talpa" class="form-label">Bilietų kiekis *</label>
            <input
              type="number"
              class="form-control"
              id="zmoniu_talpa"
              name="zmoniu_talpa"
              value="{{ koncertas.zmoniu_talpa }}"
              min="1"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="zanras" class="form-label">Žanras *</label>
            <select class="form-select" id="zanras" name="zanras" required>
              {% for value, label in zanrai %}
                <option value="{{ value }}" {% if koncertas.zanras == value %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="input-group mb-3">
          <div class="dropup">
            <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="true" data-bs-auto-close="outside">
              Pridėti vietą
            </button>
            <div class="dropdown-menu p-4" style="width: 30rem" data-popper-placement="bottom-start" style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate(0px, 40px);">
              <h4>Pridėti vietą</h4>
              <div class="mb-3">
                <label class="form-label">Pavadinimas</label>
                <input
                  type="text"
                  name="vieta_pavadinimas"
                  class="form-control"
                />
              </div>

              <div class="mb-3">
                <label class="form-label">Adresas</label>
                <input
                  type="text"
                  name="vieta_adresas"
                  class="form-control"
                />
              </div>

              <div class="mb-3">
                <label class="form-label">Miestas</label>
                <input
                  type="text"
                  name="vieta_miestas"
                  class="form-control"
                />
              </div>

              <div class="mb-3">
                <label class="form-label">Šalis</label>
                <input
                  type="text"
                  name="vieta_salis"
                  class="form-control"
                />
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Platuma</label>
                  <input
                    type="number"
                    step="any"
                    name="vieta_platuma"
                    class="form-control"
                    value="0"
                  />
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Ilguma</label>
                  <input
                    type="number"
                    step="any"
                    name="vieta_ilguma"
                    class="form-control"
                    value="0"
                  />
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Laiko zona</label>
                <input
                  type="text"
                  name="vieta_laiko_zona"
                  class="form-control"
                  placeholder="Europe/Vilnius"
                />
              </div>
              <button type="submit" name="vieta_prideti" value="vieta_prideti" class="btn btn-primary">Pridėti</button>
            </div>
          </div>
          <select class="form-select" id="vieta" name="vieta">
            <option value="">Pasirinkite vietą</option>
            {% for vieta in vietos %}
              <option value="{{ vieta.id }}" {% if koncertas.vieta.id == vieta.id %}selected{% endif %}>{{ vieta.pavadinimas }} - {{ vieta.miestas }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3 form-check">
          <input
            type="checkbox"
            class="form-check-input"
            id="yra_atsauktas"
            name="yra_atsauktas"
            {% if koncertas.yra_atsauktas %}checked{% endif %}
          />
          <label class="form-check-label" for="yra_atsauktas">Atšauktas</label>
        </div>

        <div class="mb-3 form-check">
          <input
            type="checkbox"
            class="form-check-input"
            id="yra_viesas"
            name="yra_viesas"
            {% if koncertas.yra_viesas %}checked{% endif %}
          />
          <label class="form-check-label" for="yra_viesas">Viešas koncertas</label>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">Atnaujinti koncertą</button>
          <a href="{% url 'concerts:concertDetail' pk=koncertas.pk %}" class="btn btn-secondary">Peržiūrėti</a>
          <a href="{% url 'concerts:index' %}" class="btn btn-outline-light">Atšaukti</a>
        </div>
      </form>
    </div>
  </div>
{% endblock %}
